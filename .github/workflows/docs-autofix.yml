name: Docs â€” autofix & PR

on:
  schedule:
    - cron: '0 3 * * 1' # weekly
  workflow_dispatch: {}

jobs:
  fix-and-pr:
    name: Fix docs and open PR
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install remark + cspell
        run: |
          npm ci --no-audit --no-fund || true
          npm i -g remark-cli@10 remark-preset-lint-recommended retext-spell cspell

      - name: Apply remark automated fixes
        run: |
          set -e
          # Auto-fix docs in place
          remark -u --no-color -q docs README.md || true

      - name: Run cspell and apply suggestions
        run: |
          set -e
          cspell "docs/**" "README.md" --config .github/WORDLIST.txt || true

      - name: Configure git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Create PR for fixes
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: 'docs: auto-fix markdown formatting and spelling'
          title: 'docs: auto-fix: markdown + spelling'
          body: 'Automated cleanup: remark formatting fixes + spellcheck suggestions.'
          branch: docs/autofix-${{ github.run_number }}
          labels: docs,auto-fix
